<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DVVIA — Trust-First Car Marketplace</title>
    <meta name="description" content="Verified listings. Public meetings. No fake ads. DVVIA is a trust-first car marketplace.">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        /* Reset & Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            background: #ffffff;
            color: #333;
            line-height: 1.5;
        }

        #dvvia-page * {
            font-family: 'Inter', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif !important;
        }

        #dvvia-page {
            width: 100%;
            margin: 0;
            padding: 0;
        }

        /* Header */
        .dvvia-header {
            border-bottom: 1px solid #e5e7eb;
            background: #ffffff;
        }

        .dvvia-header-content {
            max-width: 1280px;
            margin: 0 auto;
            padding: 22px 32px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .dvvia-logo {
            font-size: 26px;
            font-weight: 700;
            color: #1e3a5f;
            text-decoration: none;
            letter-spacing: -0.5px;
        }

        .dvvia-btn-login {
            background: transparent;
            color: #1d72d8 !important;
            padding: 11px 26px;
            border-radius: 5px;
            font-weight: 500;
            text-decoration: none !important;
            display: inline-block;
            transition: all 0.2s ease;
            border: 1px solid #1d72d8;
            cursor: pointer;
            font-size: 15px;
        }

        .dvvia-btn-login:hover {
            background: #f0f7ff;
        }

        .dvvia-btn-primary {
            background: #1d72d8;
            color: white !important;
            padding: 11px 26px;
            border-radius: 5px;
            font-weight: 500;
            text-decoration: none !important;
            display: inline-block;
            transition: background-color 0.2s ease;
            border: none;
            cursor: pointer;
            font-size: 15px;
        }

        .dvvia-btn-primary:hover {
            background: #1557a8;
        }

        .dvvia-btn-large {
            padding: 16px 40px;
            font-size: 18px;
            border-radius: 6px;
        }

        /* Hero Section */
        .dvvia-hero {
            max-width: 920px;
            margin: 0 auto;
            padding: 100px 32px 110px;
            text-align: center;
        }

        .dvvia-hero h1 {
            font-size: 64px;
            font-weight: 700;
            color: #1e3a5f;
            margin-bottom: 28px;
            line-height: 1.05;
            letter-spacing: -1px;
        }

        .dvvia-hero .dvvia-tagline {
            font-size: 32px;
            color: #1f2937;
            margin-bottom: 18px;
            font-weight: 500;
            line-height: 1.25;
            letter-spacing: -0.3px;
        }

        .dvvia-hero .dvvia-subtext {
            font-size: 21px;
            color: #6b7280;
            margin-bottom: 44px;
            line-height: 1.4;
        }

        .dvvia-hero .dvvia-link {
            color: #1d72d8;
            text-decoration: underline;
            margin-top: 28px;
            display: inline-block;
            font-size: 16px;
        }

        /* Section */
        .dvvia-section {
            padding: 90px 32px;
        }

        .dvvia-section-gray {
            background: #f8f9fa;
        }

        .dvvia-container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .dvvia-container-medium {
            max-width: 800px;
            margin: 0 auto;
        }

        .dvvia-h2 {
            font-size: 40px;
            font-weight: 700;
            color: #1e3a5f;
            text-align: center;
            margin-bottom: 68px;
            line-height: 1.15;
            letter-spacing: -0.5px;
        }

        /* Grid */
        .dvvia-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
        }

        @media (min-width: 640px) {
            .dvvia-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 22px;
            }
        }

        @media (min-width: 1024px) {
            .dvvia-grid {
                grid-template-columns: repeat(4, 1fr);
                gap: 24px;
            }
        }

        .dvvia-card {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 6px;
            padding: 40px 28px;
            text-align: center;
        }

        .dvvia-card h3 {
            font-size: 18px;
            font-weight: 700;
            color: #1f2937;
            margin-bottom: 18px;
            line-height: 1.5;
        }

        .dvvia-card p {
            font-size: 15px;
            color: #6b7280;
            line-height: 1.65;
        }

        .dvvia-principles-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .dvvia-principle-item {
            display: flex;
            align-items: flex-start;
            gap: 16px;
            margin-bottom: 24px;
        }

        .dvvia-principle-item:last-child {
            margin-bottom: 0;
        }

        .dvvia-checkmark {
            width: 26px;
            height: 26px;
            flex-shrink: 0;
            margin-top: 1px;
        }

        .dvvia-principle-text {
            font-size: 19px;
            color: #1f2937;
            line-height: 1.5;
        }

        .dvvia-disclaimer {
            font-size: 15px;
            color: #9ca3af;
            line-height: 1.65;
            max-width: 680px;
            margin: 48px auto 0;
            text-align: center;
        }

        /* Footer */
        .dvvia-footer {
            border-top: 1px solid #e5e7eb;
            padding: 40px 32px;
            background: #ffffff;
        }

        .dvvia-footer-content {
            display: flex;
            justify-content: center;
            gap: 40px;
            flex-wrap: wrap;
        }

        .dvvia-footer-link {
            color: #6b7280;
            text-decoration: none;
            font-size: 15px;
        }

        .dvvia-footer-link:hover {
            color: #1f2937;
        }

        /* LOGIN PAGE STYLES */
        .dvvia-login-wrapper {
            background: #f8f9fa;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .dvvia-login-main {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 60px 24px;
        }

        .dvvia-login-container {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 56px 48px;
            max-width: 480px;
            width: 100%;
            text-align: center;
        }

        .dvvia-login-title {
            font-size: 28px;
            font-weight: 700;
            color: #1e3a5f;
            margin-bottom: 12px;
            letter-spacing: -0.3px;
        }

        .dvvia-login-subtitle {
            font-size: 16px;
            color: #6b7280;
            margin-bottom: 40px;
            line-height: 1.5;
        }

        .dvvia-code-display {
            background: #f8f9fa;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            padding: 32px 24px;
            margin-bottom: 24px;
        }

        .dvvia-code-label {
            font-size: 13px;
            font-weight: 600;
            color: #6b7280;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 12px;
        }

        .dvvia-code-value {
            font-size: 48px;
            font-weight: 700;
            color: #1e3a5f;
            letter-spacing: 8px;
            font-family: 'Courier New', monospace;
        }

        .dvvia-timer {
            font-size: 15px;
            color: #6b7280;
            margin-top: 16px;
        }

        .dvvia-timer-warning {
            color: #dc2626;
        }

        .dvvia-instruction-text {
            font-size: 17px;
            color: #374151;
            line-height: 1.6;
            margin-bottom: 32px;
        }

        .dvvia-status-pending {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            padding: 16px;
            background: #f0f7ff;
            border: 1px solid #bfdbfe;
            border-radius: 6px;
            font-size: 15px;
            color: #1d72d8;
        }

        .dvvia-spinner {
            width: 16px;
            height: 16px;
            border: 2px solid #bfdbfe;
            border-top-color: #1d72d8;
            border-radius: 50%;
            animation: dvvia-spin 0.8s linear infinite;
        }

        @keyframes dvvia-spin {
            to { transform: rotate(360deg); }
        }

        .dvvia-help-text {
            font-size: 14px;
            color: #9ca3af;
            margin-top: 32px;
            line-height: 1.6;
        }

        .dvvia-help-text a {
            color: #1d72d8;
            text-decoration: none;
        }

        .dvvia-back-link {
            color: #6b7280;
            text-decoration: none;
            font-size: 15px;
        }

        /* Responsive */
        @media (max-width: 767px) {
            .dvvia-header-content {
                padding: 18px 24px;
            }

            .dvvia-logo {
                font-size: 22px;
            }

            .dvvia-btn-login {
                padding: 9px 20px;
                font-size: 14px;
            }

            .dvvia-hero {
                padding: 64px 24px 74px;
            }

            .dvvia-hero h1 {
                font-size: 46px;
            }

            .dvvia-hero .dvvia-tagline {
                font-size: 26px;
            }

            .dvvia-section {
                padding: 64px 24px;
            }

            .dvvia-h2 {
                font-size: 32px;
            }

            .dvvia-login-container {
                padding: 40px 28px;
            }

            .dvvia-code-value {
                font-size: 40px;
                letter-spacing: 6px;
            }
        }

        @media (max-width: 480px) {
            .dvvia-hero h1 {
                font-size: 38px;
            }

            .dvvia-hero .dvvia-tagline {
                font-size: 22px;
            }

            .dvvia-h2 {
                font-size: 28px;
            }

            .dvvia-code-value {
                font-size: 36px;
                letter-spacing: 4px;
            }
        }

        html {
            scroll-behavior: smooth;
        }

        .dvvia-homepage { display: block; }
        .dvvia-loginpage { display: none; }
    </style>
</head>
<body>
    <div id="dvvia-page">
        <!-- HOMEPAGE -->
        <div class="dvvia-homepage">
            <header class="dvvia-header">
                <div class="dvvia-header-content">
                    <a href="/" class="dvvia-logo">DVVIA</a>
                    <a href="/login" class="dvvia-btn-login">Log in</a>
                </div>
            </header>

            <section class="dvvia-hero">
                <h1>DVVIA</h1>
                <p class="dvvia-tagline">A safer way to buy and sell cars.</p>
                <p class="dvvia-subtext">Verified listings. Public meetings. No fake ads.</p>
                <a href="#download" class="dvvia-btn-primary dvvia-btn-large">Get the App</a>
                <br>
                <a href="#how" class="dvvia-link">How it works</a>
            </section>

            <section id="how" class="dvvia-section dvvia-section-gray">
                <div class="dvvia-container">
                    <h2 class="dvvia-h2">How It Works</h2>
                    <div class="dvvia-grid">
                        <div class="dvvia-card">
                            <h3>Create an account<br>in the app</h3>
                            <p>To keep listings real<br>and reduce scams.</p>
                        </div>
                        <div class="dvvia-card">
                            <h3>Sellers verify cars<br>before posting</h3>
                            <p>VIN, title, odometer,<br>and photos are checked.</p>
                        </div>
                        <div class="dvvia-card">
                            <h3>Buyers request<br>viewings by appointment</h3>
                            <p>Meet only at public locations,<br>scheduled in advance</p>
                        </div>
                        <div class="dvvia-card">
                            <h3>No pressure, no tricks</h3>
                            <p>No fake urgency.<br>No misleading interest numbers.</p>
                        </div>
                    </div>
                </div>
            </section>

            <section class="dvvia-section">
                <div class="dvvia-container-medium">
                    <h2 class="dvvia-h2">Our Trust Principles</h2>
                    <ul class="dvvia-principles-list">
                        <li class="dvvia-principle-item">
                            <svg class="dvvia-checkmark" fill="#1d72d8" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
                            </svg>
                            <span class="dvvia-principle-text">VIN verified before publishing</span>
                        </li>
                        <li class="dvvia-principle-item">
                            <svg class="dvvia-checkmark" fill="#1d72d8" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
                            </svg>
                            <span class="dvvia-principle-text">Original photos only</span>
                        </li>
                        <li class="dvvia-principle-item">
                            <svg class="dvvia-checkmark" fill="#1d72d8" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
                            </svg>
                            <span class="dvvia-principle-text">Public meeting locations</span>
                        </li>
                        <li class="dvvia-principle-item">
                            <svg class="dvvia-checkmark" fill="#1d72d8" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
                            </svg>
                            <span class="dvvia-principle-text">Appointments required</span>
                        </li>
                        <li class="dvvia-principle-item">
                            <svg class="dvvia-checkmark" fill="#1d72d8" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
                            </svg>
                            <span class="dvvia-principle-text">Honest interest signals only</span>
                        </li>
                    </ul>
                    <p class="dvvia-disclaimer">After creating an account in the app, you can also view listings on the website. Actions like posting cars or scheduling viewings still require the app for safety.</p>
                </div>
            </section>

            <footer class="dvvia-footer">
                <div class="dvvia-footer-content">
                    <a href="/privacy" class="dvvia-footer-link">Privacy</a>
                    <a href="/terms" class="dvvia-footer-link">Terms</a>
                    <a href="/contact" class="dvvia-footer-link">Contact</a>
                </div>
            </footer>
        </div>

        <!-- LOGIN PAGE -->
        <div class="dvvia-loginpage dvvia-login-wrapper">
            <header class="dvvia-header">
                <div class="dvvia-header-content">
                    <a href="/" class="dvvia-logo">DVVIA</a>
                    <a href="/" class="dvvia-back-link">← Back to home</a>
                </div>
            </header>

            <main class="dvvia-login-main">
                <div class="dvvia-login-container">
                    <h1 class="dvvia-login-title">Log in on this device</h1>
                    <p class="dvvia-login-subtitle">Open the DVVIA app and enter this code</p>

                    <div class="dvvia-code-display">
                        <div class="dvvia-code-label">Your login code</div>
                        <div class="dvvia-code-value" id="loginCode">------</div>
                        <div class="dvvia-timer" id="timer">Loading...</div>
                    </div>

                    <p class="dvvia-instruction-text">
                        Open the DVVIA app on your phone, go to <strong>Settings → Log in on another device</strong>, and enter the code above.
                    </p>

                    <div class="dvvia-status-pending" id="statusMessage">
                        <div class="dvvia-spinner"></div>
                        <span>Waiting for approval...</span>
                    </div>

                    <div class="dvvia-help-text">
                        Don't have the app? <a href="#download">Download DVVIA</a>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <script>
        // Detect if this is login page or homepage
        const isLoginPage = window.location.pathname.includes('/login') || window.location.search.includes('login');
        
        if (isLoginPage) {
            document.querySelector('.dvvia-homepage').style.display = 'none';
            document.querySelector('.dvvia-loginpage').style.display = 'flex';
            initLoginFlow();
        } else {
            document.querySelector('.dvvia-homepage').style.display = 'block';
            document.querySelector('.dvvia-loginpage').style.display = 'none';
        }

        // LOGIN FLOW JAVASCRIPT
        const API_BASE = '/wp-json/dvvia/v1/web-login';
        const POLL_INTERVAL = 2000;
        let loginSessionId = null;
        let expiresAt = null;
        let pollTimer = null;
        let countdownTimer = null;

        async function initLoginFlow() {
            try {
                const response = await fetch(`${API_BASE}/start`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                });

                if (!response.ok) throw new Error('Failed to start login session');

                const data = await response.json();
                loginSessionId = data.login_session_id;
                expiresAt = new Date(data.expires_at);
                
                document.getElementById('loginCode').textContent = data.code;
                startPolling();
                startCountdown();
            } catch (error) {
                console.error('Login error:', error);
                document.getElementById('statusMessage').innerHTML = '<span style="color: #dc2626;">Unable to start login. Please refresh.</span>';
            }
        }

        async function checkStatus() {
            if (!loginSessionId) return;

            try {
                const response = await fetch(`${API_BASE}/status`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ login_session_id: loginSessionId })
                });

                if (!response.ok) throw new Error('Failed to check status');

                const data = await response.json();

                if (data.status === 'approved') {
                    stopPolling();
                    document.getElementById('statusMessage').innerHTML = '<span style="color: #059669; font-weight: 600;">✓ Login approved! Redirecting...</span>';
                    document.getElementById('statusMessage').style.background = '#d1fae5';
                    document.getElementById('statusMessage').style.borderColor = '#a7f3d0';
                    setTimeout(() => window.location.href = '/listings', 1500);
                } else if (data.status === 'expired') {
                    stopPolling();
                    document.getElementById('statusMessage').innerHTML = '<span style="color: #dc2626;">Code expired. <a href="/login" style="color: #dc2626; text-decoration: underline;">Get a new code</a></span>';
                    document.getElementById('statusMessage').style.background = '#fef2f2';
                    document.getElementById('statusMessage').style.borderColor = '#fecaca';
                }
            } catch (error) {
                console.error('Status check error:', error);
            }
        }

        function startPolling() {
            pollTimer = setInterval(checkStatus, POLL_INTERVAL);
        }

        function stopPolling() {
            if (pollTimer) clearInterval(pollTimer);
            if (countdownTimer) clearInterval(countdownTimer);
        }

        function startCountdown() {
            updateCountdown();
            countdownTimer = setInterval(updateCountdown, 1000);
        }

        function updateCountdown() {
            const now = new Date();
            const remaining = Math.max(0, Math.floor((expiresAt - now) / 1000));
            const minutes = Math.floor(remaining / 60);
            const seconds = remaining % 60;
            const timerElement = document.getElementById('timer');
            
            if (remaining <= 0) {
                timerElement.textContent = 'Code expired';
                timerElement.classList.add('dvvia-timer-warning');
                stopPolling();
            } else if (remaining <= 30) {
                timerElement.textContent = `Expires in ${seconds} seconds`;
                timerElement.classList.add('dvvia-timer-warning');
            } else {
                timerElement.textContent = `Expires in ${minutes}:${seconds.toString().padStart(2, '0')}`;
            }
        }

        window.addEventListener('beforeunload', stopPolling);
    </script>
</body>
</html>
